using UnityEngine;
using System.Collections;
public abstract class {{ class_name }}AbstractFSM : AbstractFSM {
    public enum State { 
        {%- for state in states %}
        {{ state.name }} = {{state.id}}{% if not loop.last %},{%endif%}
        {%- endfor %}
    }  
    public State state = State.{{ init_state }};
    protected override IEnumerator FSMThread( float delayRate ) {
        while(true) {
            State prevState = state;
            // The following switch statement handles the state machine's action logic
            switch(state) {
                {%- for state in states %}
                case State.{{state.name}}:
                    yield return ExecuteAction{{ state.name }}();
                    break;
                {%- endfor %}
            }
            {% if type == "mealy" %}
            {% include "Unity_MDP.jinja" %}
            {% else %}
            {% include "Unity_HLSM.jinja" %}
            {% endif %}
            
            yield return new WaitForSeconds( delayRate );
            if ( prevState!=state ) {
                transitionedAt = Time.time;
                OnTransition();
            }
        }
    }

    // State Logic Functions
    {%- for state in states %}
    protected abstract IEnumerator ExecuteAction{{state.name}}();
    {% endfor %}
    // Transitional Logic Functions
    {%- for transition in transitions %}
    protected abstract bool {{transition}}();
    {% endfor %}

    protected virtual void OnTransition() { }
}